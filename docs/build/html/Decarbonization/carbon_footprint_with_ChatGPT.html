

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Project 1: Reported Emissions with ChatGP &#8212; Climate Risks in Finance 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Decarbonization/carbon_footprint_with_ChatGPT';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">Climate Risks in Finance 0.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/lowcarbon.html">Portfolio Decarbonization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/net_zero.html">Towards a Net Zero Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_investing/net_zero_investing.html">Net Zero Investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_investing/portfolio_decarbonization_pathway.html">Portfolio Decarbonization Pathway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_investing/portfolio_alignment.html">Portfolio Alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_investing/self_decarbonization.html">Net Zero Backtesting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../climate_investing/integratingtransition.html">Integrating the Transition Dimension</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Decarbonization/carbon_footprint_with_ChatGPT.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Project 1: Reported Emissions with ChatGP</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chatie">ChatIE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-information-extraction">What is Information Extraction?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chatie-framework-for-zero-shot-ie">ChatIE Framework for Zero-Shot IE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ie-tasks-and-chatie">IE Tasks and ChatIE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entity-relation-triple-extraction">Entity-Relation Triple Extraction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-re">First Stage RE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-re">Second Stage RE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#format-for-n-stages">Format for N Stages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#re-framework">RE Framework</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#named-entity-recognition">Named Entity Recognition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-ner">First Stage NER</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-ner">Second Stage NER</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Format for N Stages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ner-framework">NER Framework</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#event-extraction">Event Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-ee">First Stage EE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-ee">Second Stage EE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ee-framework">EE Framework</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#information-retrieval-with-the-react-framework">Information Retrieval with the ReAct Framework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-reported-emissions-extraction-with-chatgpt">Exercice: Reported Emissions Extraction with ChatGPT</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="project-1-reported-emissions-with-chatgp">
<h1>Project 1: Reported Emissions with ChatGP<a class="headerlink" href="#project-1-reported-emissions-with-chatgp" title="Permalink to this headline">#</a></h1>
<p>Gathering data needed for portfolio decarbonization can be challenging for three reasons:</p>
<ul class="simple">
<li><p>Emissions reporting is not well-standardized yet, and not freely available in a centralized platform</p></li>
<li><p>Data disclosed by companies can be misleading (especially for Scope 3)</p></li>
<li><p>A majority of companies still doesn’t disclose any data about carbon emissions, or only disclose partial data (especially without Scope 3 reporting)</p></li>
</ul>
<p>In this part, we will test how ChatGPT can help in gathering emissions data disclosed by companies.</p>
<p>First, you need to make sure that both <code class="docutils literal notranslate"><span class="pre">openai</span></code> and <code class="docutils literal notranslate"><span class="pre">langchain</span></code> are installed:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>!pip install openai
!pip install langchain
</pre></div>
</div>
<p>You need to declare your OpenAI API as an environment variable:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">openai_api_key</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<section id="chatie">
<h2>ChatIE<a class="headerlink" href="#chatie" title="Permalink to this headline">#</a></h2>
<p>In this section, we expose the zero shot information extraction framework, based on ChatGPT capabilities.</p>
<section id="what-is-information-extraction">
<h3>What is Information Extraction?<a class="headerlink" href="#what-is-information-extraction" title="Permalink to this headline">#</a></h3>
<p>Information extraction aims to extract structured information from unstructured text into structured data formats. Tasks can be:</p>
<ul class="simple">
<li><p>entity-relation extract (RE)</p></li>
<li><p>named entity recognition (NER)</p></li>
<li><p>event extraction (EE)</p></li>
</ul>
<p>Information extraction systems are usually build with a supervised learning approach, involving labeling data, which is time-consuming.</p>
<p>On the other side, recent works on large-scale pre-trained language models (LLMs) such as GPT-3 (Brown et al., 2020 <span id="id1">[<a class="reference internal" href="../references.html#id37" title="Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, and others. Language models are few-shot learners. Advances in neural information processing systems, 33:1877–1901, 2020.">BMR+20</a>]</span>) shows impressive results on various tasks without tuning the initial parameters but only with a few labeled examples (few-shot learning).</p>
</section>
<section id="chatie-framework-for-zero-shot-ie">
<h3>ChatIE Framework for Zero-Shot IE<a class="headerlink" href="#chatie-framework-for-zero-shot-ie" title="Permalink to this headline">#</a></h3>
<p>In their paper, Wei et al. (2023) propose a framework to prompt LLMs, and ChatGPT in particular, to perfom zero-shot IE tasks. More specifically, the authors propose the ChatIE framework that transforms the zero-shot IE task into a multi-turn question answering problem, with a two-stage approach:</p>
<ul class="simple">
<li><p>in the first stage, the aim is to find the corresponding element types existing in a sentence</p></li>
<li><p>in the second stage, it performs a chained information extraction to each element from the previous stage
Each stage is implemented with a multi-turn QA process.
In each turn, the authors construct prompts based on pre-designed templates and previously extracted information as input to ask ChatGPT.
Finally, the results of each are turned into structured data.</p></li>
</ul>
<p>The IE task is thus decomposed into two stages, each one containing several turns of QA (dialogue with ChatGPT).</p>
</section>
<section id="ie-tasks-and-chatie">
<h3>IE Tasks and ChatIE<a class="headerlink" href="#ie-tasks-and-chatie" title="Permalink to this headline">#</a></h3>
<section id="entity-relation-triple-extraction">
<h4>Entity-Relation Triple Extraction<a class="headerlink" href="#entity-relation-triple-extraction" title="Permalink to this headline">#</a></h4>
<p>Let’s denote a sente <span class="math notranslate nohighlight">\(x\)</span> and question prompt <span class="math notranslate nohighlight">\(q\)</span>, the model is built to predict triples (Wei et al., 2023):</p>
<div class="amsmath math notranslate nohighlight" id="equation-11e04e63-5a4e-49ba-8402-66b65021b04b">
<span class="eqno">(1)<a class="headerlink" href="#equation-11e04e63-5a4e-49ba-8402-66b65021b04b" title="Permalink to this equation">#</a></span>\[\begin{equation}
T(x) = \{(s_1,r_1,o1),\cdots, (s_n, r_n, o_n)\}
\end{equation}\]</div>
<p>For an output triple <span class="math notranslate nohighlight">\((s,r,o)\)</span> the process can be expressed as (Wei et al., 2023):</p>
<div class="amsmath math notranslate nohighlight" id="equation-b0f0e2cf-c453-4f31-a2e6-5c2ca4508405">
<span class="eqno">(2)<a class="headerlink" href="#equation-b0f0e2cf-c453-4f31-a2e6-5c2ca4508405" title="Permalink to this equation">#</a></span>\[\begin{equation}
p((s,r,o)|x,q) = p(r|x, q_1)p((s,o)|q_r)\cdots
\end{equation}\]</div>
<p>with <span class="math notranslate nohighlight">\(q_1\)</span> is the question generated using relation types list <span class="math notranslate nohighlight">\(R\)</span> and the corresponding template in the first stage and <span class="math notranslate nohighlight">\(q_r\)</span> is the question generated using the template related to the previously extracted relation type in the second stage.</p>
<p><span class="math notranslate nohighlight">\(x\)</span> is omitted in the second stage because ChatGPT can record the relevant information of each turn QA.</p>
<p>In adition, further several turns QA are needed for complex-object values (ie. object with multiple attributes).</p>
<p>Let’s have an example in Python.</p>
<p>We assume the following sentence:</p>
<p>“Bob worked for Google in Beijing, the capital of China”</p>
<p>The relation-types are the followings:</p>
<ul class="simple">
<li><p>‘location-located_in’</p></li>
<li><p>‘administrative_division-country’</p></li>
<li><p>‘person-place_lived’</p></li>
<li><p>‘person-company’</p></li>
<li><p>‘person-nationality’</p></li>
<li><p>‘company-founders’</p></li>
<li><p>‘country-administrative_divisions’</p></li>
<li><p>‘person-children’</p></li>
<li><p>‘country-capital’</p></li>
<li><p>‘deceased_person-place_of_death’</p></li>
<li><p>‘neighborhood-neighborhood_of’</p></li>
<li><p>‘person-place_of_birth’</p></li>
</ul>
<p>The subject types are:</p>
<ul class="simple">
<li><p>‘organization’</p></li>
<li><p>‘person’</p></li>
<li><p>‘location’</p></li>
<li><p>‘country’</p></li>
</ul>
<p>And the object types are:</p>
<ul class="simple">
<li><p>‘person’</p></li>
<li><p>‘location’</p></li>
<li><p>‘country’</p></li>
<li><p>‘organization’</p></li>
<li><p>‘city’</p></li>
</ul>
<p>Let’s first define the <code class="docutils literal notranslate"><span class="pre">relation_types</span></code> dictionnary:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relation_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;location-located_in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="s1">&#39;administrative_division-country&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">],</span>
            <span class="s1">&#39;person-place_lived&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="s1">&#39;person-company&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;organization&#39;</span><span class="p">],</span>
            <span class="s1">&#39;person-nationality&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">],</span>
            <span class="s1">&#39;company-founders&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;organization&#39;</span><span class="p">,</span> <span class="s1">&#39;person&#39;</span><span class="p">],</span>
            <span class="s1">&#39;country-administrative_divisions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="s1">&#39;person-children&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;person&#39;</span><span class="p">],</span>
            <span class="s1">&#39;country-capital&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">],</span>
            <span class="s1">&#39;deceased_person-place_of_death&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="s1">&#39;neighborhood-neighborhood_of&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="s1">&#39;person-place_of_birth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">],</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>We instantiate our <code class="docutils literal notranslate"><span class="pre">ChatOpenAI</span></code> object:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="n">chat</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                  <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="first-stage-re">
<h4>First Stage RE<a class="headerlink" href="#first-stage-re" title="Permalink to this headline">#</a></h4>
<p>We can now begin with the first stage of the process.</p>
<p>We want to format the answer into an easily parsable format:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.output_parsers</span> <span class="kn">import</span> <span class="n">StructuredOutputParser</span><span class="p">,</span> <span class="n">ResponseSchema</span>
<span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">    output it as a comma separated Python list&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
<span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>
</pre></div>
</div>
<p>We create the prompt template for the first stage:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relation_extraction_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is &quot;</span><span class="si">{sentence}</span><span class="se">\n\n\</span>
<span class="s2">List of given relations:&quot;</span><span class="si">{rtl}</span><span class="s2">&quot;</span><span class="se">\n\n\</span>
<span class="s2">What relations in the given list might be included in this given sentence?</span><span class="se">\n\</span>
<span class="s2">If not present, answer: none.</span><span class="se">\n\</span>
<span class="si">{format_instructions}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>

<span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">relation_extraction_template_stage_1</span><span class="p">)</span>

<span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">rtl</span> <span class="o">=</span> <span class="n">rtl</span><span class="p">,</span>
                                          <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">format_instructions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>The message is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The given sentence is &quot;Bob worked for Google in Beijing, the capital of China.

List of given relations:&quot;[&#39;location-located_in&#39;, &#39;administrative_division-country&#39;, &#39;person-place_lived&#39;, &#39;person-company&#39;, &#39;person-nationality&#39;, &#39;company-founders&#39;, &#39;country-administrative_divisions&#39;, &#39;person-children&#39;, &#39;country-capital&#39;, &#39;deceased_person-place_of_death&#39;, &#39;neighborhood-neighborhood_of&#39;, &#39;person-place_of_birth&#39;]&quot;

What relations in the given list might be included in this given sentence?
If not present, answer: none.
The output should be a markdown code snippet formatted in the following schema, including the leading and trailing &quot;\`\`\`json&quot; and &quot;\`\`\`&quot;:

json
{
	&quot;answer&quot;: string  // answer to the user&#39;s question.    output it as a comma separated Python list
}
</pre></div>
</div>
<p>And let’s ask ChatGPT for the first stage answer:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>And the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;person-company&#39;</span><span class="p">,</span> <span class="s1">&#39;location-located_in&#39;</span><span class="p">,</span> <span class="s1">&#39;country-capital&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="second-stage-re">
<h4>Second Stage RE<a class="headerlink" href="#second-stage-re" title="Permalink to this headline">#</a></h4>
<p>Let’s now address the second stage of the RE process.</p>
<p>We first need to create a template for the <span class="math notranslate nohighlight">\(n\)</span> chained questions to ChatGPT:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">relation_extraction_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is: &quot;</span><span class="si">{sentence}</span><span class="s2">&quot; </span><span class="se">\n\n\</span>
<span class="s2">    According to the given sentence,</span><span class="se">\</span>
<span class="s2">    the two entities are of type (&#39;</span><span class="si">{type_1}</span><span class="s2">&#39;, &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;)</span><span class="se">\</span>
<span class="s2">    and the relation between them is &#39;</span><span class="si">{relation_type}</span><span class="s2">&#39;,</span><span class="se">\</span>
<span class="s2">    find the two entities and list them all by group if there are multiple groups.</span><span class="se">\n\</span>
<span class="s2">    If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">    Extract the following information:</span>
<span class="s2">    &#39;</span><span class="si">{type_1}</span><span class="s2">&#39;: the entities of type &#39;</span><span class="si">{type_1}</span><span class="s2">&#39; and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">    &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;: the entities of type &#39;</span><span class="si">{type_2}</span><span class="s2">&#39; and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">    Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">    &#39;</span><span class="si">{type_1}</span><span class="s2">&#39;, &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">relation_extraction_template_stage_n</span><span class="p">)</span>

<span class="n">relation_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">type_1</span> <span class="o">=</span> <span class="n">relation_types</span><span class="p">[</span><span class="n">relation_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">type_2</span> <span class="o">=</span> <span class="n">relation_types</span><span class="p">[</span><span class="n">relation_type</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">type_1</span> <span class="o">=</span> <span class="n">type_1</span><span class="p">,</span>
                                          <span class="n">type_2</span> <span class="o">=</span> <span class="n">type_2</span><span class="p">,</span>
                                          <span class="n">relation_type</span> <span class="o">=</span> <span class="n">relation_type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>The message is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">given</span> <span class="n">sentence</span> <span class="ow">is</span><span class="p">:</span> <span class="s2">&quot;Bob worked for Google in Beijing, the capital of China.&quot;</span> 

<span class="n">According</span> <span class="n">to</span> <span class="n">the</span> <span class="n">given</span> <span class="n">sentence</span><span class="p">,</span><span class="n">the</span> <span class="n">two</span> <span class="n">entities</span> <span class="n">are</span> <span class="n">of</span> <span class="nb">type</span> <span class="p">(</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;organization&#39;</span><span class="p">)</span><span class="ow">and</span> <span class="n">the</span> <span class="n">relation</span> <span class="n">between</span> <span class="n">them</span> <span class="ow">is</span> <span class="s1">&#39;person-company&#39;</span><span class="p">,</span><span class="n">find</span> <span class="n">the</span> <span class="n">two</span> <span class="n">entities</span> <span class="ow">and</span> <span class="nb">list</span> <span class="n">them</span> <span class="nb">all</span> <span class="n">by</span> <span class="n">group</span> <span class="k">if</span> <span class="n">there</span> <span class="n">are</span> <span class="n">multiple</span> <span class="n">groups</span><span class="o">.</span>
<span class="n">If</span> <span class="ow">not</span> <span class="n">present</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">none</span><span class="o">.</span>
<span class="n">Respond</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="n">a</span> <span class="n">JSON</span> <span class="k">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">keys</span><span class="p">:</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="s1">&#39;organization&#39;</span>
</pre></div>
</div>
<p>Let’s retrieve the answer from ChatGPT:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>It results into a readable JSON:</p>
<div class="highlight-Json notranslate"><div class="highlight"><pre><span></span>{&#39;person&#39;: [&#39;Bob&#39;], &#39;organization&#39;: [&#39;Google&#39;]}
</pre></div>
</div>
</section>
<section id="format-for-n-stages">
<h4>Format for N Stages<a class="headerlink" href="#format-for-n-stages" title="Permalink to this headline">#</a></h4>
<p>Because we have potentially to ask further questions to ChatGPT, let’s create a function to systematize the generation for the second stage:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_stage_n</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">list_relation_types</span><span class="p">):</span>
  <span class="n">relation_extraction_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is: &quot;</span><span class="si">{sentence}</span><span class="s2">&quot; </span><span class="se">\n\n\</span>
<span class="s2">        According to the given sentence,</span><span class="se">\</span>
<span class="s2">        the two entities are of type (&#39;</span><span class="si">{type_1}</span><span class="s2">&#39;, &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;)</span><span class="se">\</span>
<span class="s2">        and the relation between them is &#39;</span><span class="si">{relation_type}</span><span class="s2">&#39;,</span><span class="se">\</span>
<span class="s2">        find the two entities and list them all by group if there are multiple groups.</span><span class="se">\n\</span>
<span class="s2">        If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">        Extract the following information:</span>
<span class="s2">        &#39;</span><span class="si">{type_1}</span><span class="s2">&#39;: the entities of type &#39;</span><span class="si">{type_1}</span><span class="s2">&#39; and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">        &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;: the entities of type &#39;</span><span class="si">{type_2}</span><span class="s2">&#39; and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">        Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">        &#39;</span><span class="si">{type_1}</span><span class="s2">&#39;, &#39;</span><span class="si">{type_2}</span><span class="s2">&#39;</span>
<span class="s2">        &quot;&quot;&quot;</span>
  <span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">relation_extraction_template_stage_n</span><span class="p">)</span>
  <span class="n">type_1</span> <span class="o">=</span> <span class="n">list_relation_types</span><span class="p">[</span><span class="n">relation_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">type_2</span> <span class="o">=</span> <span class="n">list_relation_types</span><span class="p">[</span><span class="n">relation_type</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                            <span class="n">type_1</span> <span class="o">=</span> <span class="n">type_1</span><span class="p">,</span>
                                            <span class="n">type_2</span> <span class="o">=</span> <span class="n">type_2</span><span class="p">,</span>
                                            <span class="n">relation_type</span> <span class="o">=</span> <span class="n">relation_type</span><span class="p">)</span>
  <span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">second_response</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
    <span class="n">formated_response</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">formated_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">formated_response</span>
</pre></div>
</div>
<p>Let’s test it:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">generate_stage_n</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span> <span class="n">relation_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">list_relation_types</span><span class="o">=</span><span class="n">relation_types</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">],</span> <span class="s1">&#39;organization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Google&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">generate_stage_n</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span> <span class="n">relation_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">list_relation_types</span><span class="o">=</span><span class="n">relation_types</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;China&#39;</span><span class="p">],</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Beijing&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</section>
<section id="re-framework">
<h4>RE Framework<a class="headerlink" href="#re-framework" title="Permalink to this headline">#</a></h4>
<p>We can now create a function to define the two-stages process:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">chatie_re</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">list_relation_types</span><span class="p">):</span>
  
  <span class="n">chat</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="p">)</span>
  
  <span class="c1"># First stage</span>
  <span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">    output it as a comma separated Python list&quot;</span><span class="p">),</span>
<span class="p">]</span>
  <span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
  <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>

  <span class="n">relation_extraction_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is &quot;</span><span class="si">{sentence}</span><span class="se">\n\n\</span>
<span class="s2">  List of given relations:&quot;</span><span class="si">{rtl}</span><span class="s2">&quot;</span><span class="se">\n\n\</span>
<span class="s2">  What relations in the given list might be included in this given sentence?</span><span class="se">\n\</span>
<span class="s2">  If not present, answer: none.</span><span class="se">\n\</span>
<span class="s2">  </span><span class="si">{format_instructions}</span><span class="s2"></span>
<span class="s2">  &quot;&quot;&quot;</span>
  <span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">relation_extraction_template_stage_1</span><span class="p">)</span>
  <span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">rtl</span> <span class="o">=</span> <span class="n">rtl</span><span class="p">,</span>
                                          <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">format_instructions</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>
  <span class="n">output</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

  <span class="n">list_jsons</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">])):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">generate_stage_n</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span> <span class="n">relation_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                              <span class="n">list_relation_types</span><span class="o">=</span><span class="n">list_relation_types</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">answer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">list_jsons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">list_jsons</span>
</pre></div>
</div>
<p>We can test it:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">chatie_re</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                 <span class="n">list_relation_types</span><span class="o">=</span><span class="n">relation_types</span><span class="p">)</span>
<span class="n">test</span>
</pre></div>
</div>
<p>The result is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">],</span> <span class="s1">&#39;organization&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Google&#39;</span><span class="p">]},</span>
 <span class="p">{</span><span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;China&#39;</span><span class="p">],</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Beijing&#39;</span><span class="p">]},</span>
 <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">]}]</span>
</pre></div>
</div>
<p>It worked!</p>
</section>
</section>
<section id="named-entity-recognition">
<h3>Named Entity Recognition<a class="headerlink" href="#named-entity-recognition" title="Permalink to this headline">#</a></h3>
<p>In the NER task, the first stage is to filter out the existing entity types in the sentence given the desired type list. Once the framework returns the entity types, the input for the second stage can be constructed accordingly.</p>
<p>In the second stage, each turn aims to extract the entities of one type. Then, the number of turns in the second stage corresponds to the number of turns in the first stage.</p>
<p>Let’s also have an example in Python.</p>
<p>We have the following entity types:</p>
<ul class="simple">
<li><p>‘LOC’</p></li>
<li><p>‘PER’</p></li>
<li><p>‘ORG’</p></li>
<li><p>‘MISC’</p></li>
</ul>
<p>Let’s declare it in a list format in Python:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">entity_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LOC&quot;</span><span class="p">,</span><span class="s2">&quot;MISC&quot;</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="p">,</span> <span class="s2">&quot;PER&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="first-stage-ner">
<h4>First Stage NER<a class="headerlink" href="#first-stage-ner" title="Permalink to this headline">#</a></h4>
<p>We first create our prompt template:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.output_parsers</span> <span class="kn">import</span> <span class="n">StructuredOutputParser</span><span class="p">,</span> <span class="n">ResponseSchema</span>
<span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">    output it as a comma separated Python list&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
<span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>

<span class="n">ner_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is &quot;</span><span class="si">{sentence}</span><span class="se">\n\n\</span>
<span class="s2">Given a list of entity types:&quot;</span><span class="si">{list_entity_types}</span><span class="s2">&quot;</span><span class="se">\n\n\</span>
<span class="s2">What entity types may be included in this sentence?</span><span class="se">\n\</span>
<span class="s2">If not present, answer: none.</span><span class="se">\n\</span>
<span class="si">{format_instructions}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>

<span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ner_template_stage_1</span><span class="p">)</span>

<span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">list_entity_types</span> <span class="o">=</span> <span class="n">entity_types</span><span class="p">,</span>
                                          <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">format_instructions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>Our prompt is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The given sentence is &quot;Bob worked for Google in Beijing, the capital of China.

Given a list of entity types:&quot;[&#39;LOC&#39;, &#39;MISC&#39;, &#39;ORG&#39;, &#39;PER&#39;]&quot;

What entity types may be included in this sentence?
If not present, answer: none.
The output should be a markdown code snippet formatted in the following schema, including the leading and trailing &quot;\`\`\`json&quot; and &quot;\`\`\`&quot;:

json
{
	&quot;answer&quot;: string  // answer to the user&#39;s question.    output it as a comma separated Python list
}
</pre></div>
</div>
<p>And we can get the answer as a nicely formated Python list:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORG&#39;</span><span class="p">,</span> <span class="s1">&#39;PER&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="second-stage-ner">
<h4>Second Stage NER<a class="headerlink" href="#second-stage-ner" title="Permalink to this headline">#</a></h4>
<p>We can now move to the second stage of the process, with a new prompt template:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ner_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is: &quot;</span><span class="si">{sentence}</span><span class="s2">&quot; </span><span class="se">\n\n\</span>
<span class="s2">According to the given sentence,</span><span class="se">\</span>
<span class="s2">please identify the entity whose type is &#39;</span><span class="si">{entity_type}</span><span class="s2">&#39;</span>
<span class="s2">If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">Extract the following information: </span><span class="se">\n\</span>
<span class="s2">&#39;entity_type&#39;: the entity types and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">&#39;entity_name&#39;: the entities names and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">&#39;entity_type&#39;, &#39;entity_name&#39;</span>

<span class="s2">Make sure to return only the information for entity of type &#39;</span><span class="si">{entity_type}</span><span class="s2">&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ner_template_stage_n</span><span class="p">)</span>
</pre></div>
</div>
<p>We retrieve the information from the first answer:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">entity_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>And we create our second prompt:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">given</span> <span class="n">sentence</span> <span class="ow">is</span><span class="p">:</span> <span class="s2">&quot;Bob worked for Google in Beijing, the capital of China.&quot;</span> 

<span class="n">According</span> <span class="n">to</span> <span class="n">the</span> <span class="n">given</span> <span class="n">sentence</span><span class="p">,</span><span class="n">please</span> <span class="n">identify</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">whose</span> <span class="nb">type</span> <span class="ow">is</span> <span class="s1">&#39;LOC&#39;</span>
<span class="n">If</span> <span class="ow">not</span> <span class="n">present</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">none</span><span class="o">.</span>

<span class="n">Extract</span> <span class="n">the</span> <span class="n">following</span> <span class="n">information</span><span class="p">:</span> 
<span class="s1">&#39;entity_type&#39;</span><span class="p">:</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">types</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">them</span> <span class="k">as</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="n">Python</span> <span class="nb">list</span> 
<span class="s1">&#39;entity_name&#39;</span><span class="p">:</span> <span class="n">the</span> <span class="n">entities</span> <span class="n">names</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">them</span> <span class="k">as</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="n">Python</span> <span class="nb">list</span> 

<span class="n">Respond</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="n">a</span> <span class="n">JSON</span> <span class="k">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">keys</span><span class="p">:</span><span class="s1">&#39;entity_type&#39;</span><span class="p">,</span> <span class="s1">&#39;entity_name&#39;</span>

<span class="n">Make</span> <span class="n">sure</span> <span class="n">to</span> <span class="k">return</span> <span class="n">only</span> <span class="n">the</span> <span class="n">information</span> <span class="k">for</span> <span class="n">entity</span> <span class="n">of</span> <span class="nb">type</span> <span class="s1">&#39;LOC&#39;</span>
</pre></div>
</div>
<p>And ask to ChatGPT:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>

<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>Which gives the expected result:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{&#39;entity_type&#39;: [&#39;LOC&#39;], &#39;entity_name&#39;: [&#39;Beijing&#39;, &#39;China&#39;]}
</pre></div>
</div>
</section>
<section id="id2">
<h4>Format for N Stages<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<p>We can now create our <code class="docutils literal notranslate"><span class="pre">generate_stage_n_ner</span></code> function:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_stage_n_ner</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">list_entity_types</span><span class="p">):</span>
  <span class="n">ner_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is: &quot;</span><span class="si">{sentence}</span><span class="s2">&quot; </span><span class="se">\n\n\</span>
<span class="s2">  According to the given sentence,</span><span class="se">\</span>
<span class="s2">  please identify the entity whose type is &#39;</span><span class="si">{entity_type}</span><span class="s2">&#39;</span>
<span class="s2">  If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">  Extract the following information: </span><span class="se">\n\</span>
<span class="s2">  &#39;entity_type&#39;: the entity types and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">  &#39;entity_name&#39;: the entities names and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">  Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">  &#39;entity_type&#39;, &#39;entity_name&#39;</span>

<span class="s2">  Make sure to return only the information for entity of type &#39;</span><span class="si">{entity_type}</span><span class="s2">&#39;</span>
<span class="s2">  &quot;&quot;&quot;</span>
  <span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ner_template_stage_n</span><span class="p">)</span>

  <span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="p">)</span>
  
  <span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">second_response</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
    <span class="n">formated_response</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">formated_response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">formated_response</span>
</pre></div>
</div>
<p>And test it:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">generate_stage_n_ner</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span>
                     <span class="n">entity_type</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">list_entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{&#39;entity_type&#39;: [&#39;LOC&#39;], &#39;entity_name&#39;: [&#39;Beijing&#39;, &#39;China&#39;]}
</pre></div>
</div>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">generate_stage_n_ner</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span>
                     <span class="n">entity_type</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">list_entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{&#39;entity_type&#39;: [&#39;ORG&#39;], &#39;entity_name&#39;: [&#39;Google&#39;]}
</pre></div>
</div>
</section>
<section id="ner-framework">
<h4>NER Framework<a class="headerlink" href="#ner-framework" title="Permalink to this headline">#</a></h4>
<p>We can now create our <code class="docutils literal notranslate"><span class="pre">chatie_ner</span></code> function, implementing the two stages process:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">chatie_ner</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">list_entity_types</span><span class="p">):</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="p">)</span>
    
    <span class="c1"># First stage</span>
    <span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
      <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">      output it as a comma separated Python list&quot;</span><span class="p">),</span>
  <span class="p">]</span>
    <span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
    <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>

    <span class="n">ner_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The given sentence is &quot;</span><span class="si">{sentence}</span><span class="se">\n\n\</span>
<span class="s2">    Given a list of entity types:&quot;</span><span class="si">{list_entity_types}</span><span class="s2">&quot;</span><span class="se">\n\n\</span>
<span class="s2">    What entity types may be included in this sentence?</span><span class="se">\n\</span>
<span class="s2">    If not present, answer: none.</span><span class="se">\n\</span>
<span class="s2">    </span><span class="si">{format_instructions}</span><span class="s2"></span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ner_template_stage_1</span><span class="p">)</span>

    <span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                              <span class="n">list_entity_types</span> <span class="o">=</span> <span class="n">entity_types</span><span class="p">,</span>
                                              <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">format_instructions</span><span class="p">)</span>


    <span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="n">list_jsons</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">])):</span>
      <span class="n">answer</span> <span class="o">=</span> <span class="n">generate_stage_n_ner</span><span class="p">(</span><span class="n">chat</span> <span class="o">=</span> <span class="n">chat</span><span class="p">,</span> <span class="n">entity_type</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">list_entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">answer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">list_jsons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">list_jsons</span>
</pre></div>
</div>
<p>And test it:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">chatie_ner</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                 <span class="n">list_entity_types</span><span class="o">=</span><span class="n">entity_types</span><span class="p">)</span>
<span class="n">test</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;entity_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">],</span> <span class="s1">&#39;entity_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Beijing&#39;</span><span class="p">,</span> <span class="s1">&#39;China&#39;</span><span class="p">]},</span>
 <span class="p">{</span><span class="s1">&#39;entity_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ORG&#39;</span><span class="p">],</span> <span class="s1">&#39;entity_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Google&#39;</span><span class="p">]},</span>
 <span class="p">{</span><span class="s1">&#39;entity_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;PER&#39;</span><span class="p">],</span> <span class="s1">&#39;entity_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">]}]</span>
</pre></div>
</div>
<p>Seems to work quite well too!</p>
</section>
</section>
<section id="event-extraction">
<h3>Event Extraction<a class="headerlink" href="#event-extraction" title="Permalink to this headline">#</a></h3>
<p>The zero-shot EE task is solved with two stages:</p>
<ul class="simple">
<li><p>in the first stage, event classification is performed, formalized as a text classification problem getting event types from a given text</p></li>
<li><p>the second stage is then devoted to argument extraction, formalized as n extraction machine read comprehension (MRC) problem that identifies arguments of specific roles associated with predicted event types from the first stage</p></li>
</ul>
<p>Let’s test it with Python with a simple example.</p>
<p>We start with a new sentence:
“Yesterday Bob and his wife got divorced in Guangzhou.”</p>
<p>The event type list is:</p>
<ul class="simple">
<li><p>‘Personnel:Elect’</p></li>
<li><p>‘Business:Declare-Bankruptcy’</p></li>
<li><p>‘Justice:Arrest-Jail’</p></li>
<li><p>‘Life:Divorce’</p></li>
<li><p>‘Life:Injure’</p></li>
</ul>
<p>The argument roles are:</p>
<ul class="simple">
<li><p>‘Person’</p></li>
<li><p>‘Entity’</p></li>
<li><p>‘Position’</p></li>
<li><p>‘Time’</p></li>
<li><p>‘Place’</p></li>
<li><p>‘Org’</p></li>
<li><p>‘Agent’</p></li>
<li><p>‘Crime’</p></li>
<li><p>‘Victim’</p></li>
<li><p>‘Instrument’</p></li>
</ul>
<p>Let’s first create our new illustrative sentence and the event type list:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;Yesterday Bob and his wife got divorced in Guangzhou.&quot;</span>
<span class="n">event_types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Personnel:Elect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;Position&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">],</span> <span class="s1">&#39;Business:Declare-Bankruptcy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Org&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">],</span> <span class="s1">&#39;Justice:Arrest-Jail&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;Crime&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">],</span> <span class="s1">&#39;Life:Divorce&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">],</span> <span class="s1">&#39;Life:Injure&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;Victim&#39;</span><span class="p">,</span> <span class="s1">&#39;Instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<section id="first-stage-ee">
<h4>First Stage EE<a class="headerlink" href="#first-stage-ee" title="Permalink to this headline">#</a></h4>
<p>Let’s first create our first stage template:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">    output it as a comma separated Python list&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
<span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>

<span class="n">ee_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The list of event types: </span><span class="si">{list_event_types}</span><span class="s2"> </span><span class="se">\n\</span>
<span class="s2">Given the sentence: &#39;</span><span class="si">{sentence}</span><span class="s2">&#39; </span><span class="se">\n\</span>
<span class="s2">What types of events are included in this sentence? </span><span class="se">\n\</span>
<span class="s2">Please return the most likely answer according to the list of event types above. </span><span class="se">\n\</span>
<span class="s2">Require the answer in the form: Event type</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ee_template_stage_1</span><span class="p">)</span>

<span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">list_event_types</span> <span class="o">=</span> <span class="n">event_types</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The list of event types: {&#39;Justice:Appeal&#39;: [&#39;Defendant&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Extradite&#39;: [&#39;Agent&#39;, &#39;Person&#39;, &#39;Destination&#39;, &#39;Origin&#39;, &#39;Crime&#39;, &#39;Time&#39;], &#39;Justice:Acquit&#39;: [&#39;Defendant&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Life:Be-Born&#39;: [&#39;Person&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Life:Divorce&#39;: [&#39;Person&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Personnel:Nominate&#39;: [&#39;Person&#39;, &#39;Agent&#39;, &#39;Position&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Life:Marry&#39;: [&#39;Person&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Personnel:End-Position&#39;: [&#39;Person&#39;, &#39;Entity&#39;, &#39;Position&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Pardon&#39;: [&#39;Defendant&#39;, &#39;Prosecutor&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Business:Merge-Org&#39;: [&#39;Org&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Conflict:Attack&#39;: [&#39;Attacker&#39;, &#39;Target&#39;, &#39;Instrument&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Charge-Indict&#39;: [&#39;Defendant&#39;, &#39;Prosecutor&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Personnel:Start-Position&#39;: [&#39;Person&#39;, &#39;Entity&#39;, &#39;Position&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Business:Start-Org&#39;: [&#39;Agent&#39;, &#39;Org&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Business:End-Org&#39;: [&#39;Org&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Life:Injure&#39;: [&#39;Agent&#39;, &#39;Victim&#39;, &#39;Instrument&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Fine&#39;: [&#39;Entity&#39;, &#39;Adjudicator&#39;, &#39;Money&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Sentence&#39;: [&#39;Defendant&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Sentence&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Transaction:Transfer-Money&#39;: [&#39;Giver&#39;, &#39;Recipient&#39;, &#39;Beneficiary&#39;, &#39;Money&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Execute&#39;: [&#39;Person&#39;, &#39;Agent&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Sue&#39;: [&#39;Plaintiff&#39;, &#39;Defendant&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Arrest-Jail&#39;: [&#39;Person&#39;, &#39;Agent&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Trial-Hearing&#39;: [&#39;Defendant&#39;, &#39;Prosecutor&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Movement:Transport&#39;: [&#39;Agent&#39;, &#39;Artifact&#39;, &#39;Vehicle&#39;, &#39;Price&#39;, &#39;Origin&#39;, &#39;Destination&#39;, &#39;Time&#39;], &#39;Contact:Meet&#39;: [&#39;Entity&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Personnel:Elect&#39;: [&#39;Person&#39;, &#39;Entity&#39;, &#39;Position&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Business:Declare-Bankruptcy&#39;: [&#39;Org&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Transaction:Transfer-Ownership&#39;: [&#39;Buyer&#39;, &#39;Seller&#39;, &#39;Beneficiary&#39;, &#39;Artifact&#39;, &#39;Price&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Justice:Release-Parole&#39;: [&#39;Person&#39;, &#39;Entity&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Conflict:Demonstrate&#39;: [&#39;Entity&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Contact:Phone-Write&#39;: [&#39;Entity&#39;, &#39;Time&#39;], &#39;Justice:Convict&#39;: [&#39;Defendant&#39;, &#39;Adjudicator&#39;, &#39;Crime&#39;, &#39;Time&#39;, &#39;Place&#39;], &#39;Life:Die&#39;: [&#39;Agent&#39;, &#39;Victim&#39;, &#39;Instrument&#39;, &#39;Time&#39;, &#39;Place&#39;]} 
Given the sentence: &#39;Yesterday Bob and his wife got divorced in Guangzhou.&#39; 
What types of events are included in this sentence? 
Please return the most likely answer according to the list of event types above. 
Require the answer in the form: Event type
</pre></div>
</div>
<p>We can ask to ChatGPT:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">content</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Life</span><span class="p">:</span><span class="n">Divorce</span>
</pre></div>
</div>
</section>
<section id="second-stage-ee">
<h4>Second Stage EE<a class="headerlink" href="#second-stage-ee" title="Permalink to this headline">#</a></h4>
<p>We can now create the second stage template:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ee_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The list of argument roles corresponding to the event type </span><span class="se">\</span>
<span class="s2">&#39;</span><span class="si">{event_type}</span><span class="s2">&#39; is &#39;</span><span class="si">{list_argument_roles}</span><span class="s2">&#39;. </span><span class="se">\n\</span>
<span class="s2">In the sentece &#39;</span><span class="si">{sentence}</span><span class="s2">&#39;, please extract the following information: </span><span class="se">\n\</span>
<span class="s2">&#39;Argument_Role&#39;: the list of argument roles corresponding to the event type and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">&#39;Argument_Content&#39;: the list of event argument content corresponding to the argument roles and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">&#39;Argument_Role&#39;, &#39;Argument_Content&#39;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ee_template_stage_n</span><span class="p">)</span>

<span class="n">event_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
<span class="n">argument_roles</span> <span class="o">=</span> <span class="n">event_types</span><span class="p">[</span><span class="n">event_type</span><span class="p">]</span>

<span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span><span class="p">,</span>
                                          <span class="n">list_argument_roles</span> <span class="o">=</span> <span class="n">argument_roles</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">n_message</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>It generates the following prompt based on the previous answer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">argument</span> <span class="n">roles</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">event</span> <span class="nb">type</span> <span class="s1">&#39;Life:Divorce&#39;</span> <span class="ow">is</span> <span class="s1">&#39;[&#39;</span><span class="n">Person</span><span class="s1">&#39;, &#39;</span><span class="n">Time</span><span class="s1">&#39;, &#39;</span><span class="n">Place</span><span class="s1">&#39;]&#39;</span><span class="o">.</span> 
<span class="n">In</span> <span class="n">the</span> <span class="n">sentece</span> <span class="s1">&#39;Yesterday Bob and his wife got divorced in Guangzhou.&#39;</span><span class="p">,</span> <span class="n">please</span> <span class="n">extract</span> <span class="n">the</span> <span class="n">following</span> <span class="n">information</span><span class="p">:</span> 
<span class="s1">&#39;Argument_Role&#39;</span><span class="p">:</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">argument</span> <span class="n">roles</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">event</span> <span class="nb">type</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">them</span> <span class="k">as</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="n">Python</span> <span class="nb">list</span> 
<span class="s1">&#39;Argument_Content&#39;</span><span class="p">:</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">event</span> <span class="n">argument</span> <span class="n">content</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">the</span> <span class="n">argument</span> <span class="n">roles</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">them</span> <span class="k">as</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="n">Python</span> <span class="nb">list</span> 

<span class="n">If</span> <span class="ow">not</span> <span class="n">present</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">none</span><span class="o">.</span>

<span class="n">Respond</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="n">a</span> <span class="n">JSON</span> <span class="k">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">keys</span><span class="p">:</span><span class="s1">&#39;Argument_Role&#39;</span><span class="p">,</span> <span class="s1">&#39;Argument_Content&#39;</span>
</pre></div>
</div>
<p>Let’s ask again to ChatGPT:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>

<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>And we have:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{&#39;Argument_Role&#39;: [&#39;Person&#39;, &#39;Time&#39;, &#39;Place&#39;],
 &#39;Argument_Content&#39;: [&#39;Bob and his wife&#39;, &#39;Yesterday&#39;, &#39;Guangzhou&#39;]}
</pre></div>
</div>
</section>
<section id="ee-framework">
<h4>EE Framework<a class="headerlink" href="#ee-framework" title="Permalink to this headline">#</a></h4>
<p>Because we’ve asked in the first stage to return the most likely event type, we do not need to process n stages. We thus can directly implement our function <code class="docutils literal notranslate"><span class="pre">chatie_ee</span></code> with the two stages:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">chatie_ee</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">list_event_types</span><span class="p">):</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                  <span class="p">)</span>
    
    <span class="c1"># First stage</span>
    <span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;answer to the user&#39;s question.</span><span class="se">\</span>
<span class="s2">      output it as a comma separated Python list&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">output_parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="o">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>
    <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>

    <span class="n">ee_template_stage_1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The list of event types: </span><span class="si">{list_event_types}</span><span class="s2"> </span><span class="se">\n\</span>
<span class="s2">    Given the sentence: &#39;</span><span class="si">{sentence}</span><span class="s2">&#39; </span><span class="se">\n\</span>
<span class="s2">    What types of events are included in this sentence? </span><span class="se">\n\</span>
<span class="s2">    Please return the most likely answer according to the list of event types above. </span><span class="se">\n\</span>
<span class="s2">    Require the answer in the form: Event type</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">first_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ee_template_stage_1</span><span class="p">)</span>

    <span class="n">first_message</span> <span class="o">=</span> <span class="n">first_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                              <span class="n">list_event_types</span> <span class="o">=</span> <span class="n">event_types</span><span class="p">)</span> 
    

    <span class="n">response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">first_message</span><span class="p">)</span>

    <span class="c1"># Second Stage</span>
    <span class="n">ee_template_stage_n</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;The list of argument roles corresponding to the event type </span><span class="se">\</span>
<span class="s2">    &#39;</span><span class="si">{event_type}</span><span class="s2">&#39; is &#39;</span><span class="si">{list_argument_roles}</span><span class="s2">&#39;. </span><span class="se">\n\</span>
<span class="s2">    In the sentece &#39;</span><span class="si">{sentence}</span><span class="s2">&#39;, please extract the following information: </span><span class="se">\n\</span>
<span class="s2">    &#39;Argument_Role&#39;: the list of argument roles corresponding to the event type and output them as a comma separated Python list </span><span class="se">\n\</span>
<span class="s2">    &#39;Argument_Content&#39;: the list of event argument content corresponding to the argument roles and output them as a comma separated Python list </span><span class="se">\n\</span>

<span class="s2">    If not present, answer: none.</span><span class="se">\n\</span>

<span class="s2">    Respond in the form of a JSON with the following keys:</span><span class="se">\</span>
<span class="s2">    &#39;Argument_Role&#39;, &#39;Argument_Content&#39;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">n_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">ee_template_stage_n</span><span class="p">)</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">argument_roles</span> <span class="o">=</span> <span class="n">event_types</span><span class="p">[</span><span class="n">event_type</span><span class="p">]</span>

    <span class="n">n_message</span> <span class="o">=</span> <span class="n">n_prompt_template</span><span class="o">.</span><span class="n">format_messages</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                                          <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span><span class="p">,</span>
                                          <span class="n">list_argument_roles</span> <span class="o">=</span> <span class="n">argument_roles</span><span class="p">)</span>
    
    <span class="n">second_response</span> <span class="o">=</span> <span class="n">chat</span><span class="p">(</span><span class="n">n_message</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">second_response</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
      <span class="n">formated_response</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">formated_response</span> <span class="o">=</span>  <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">second_response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formated_response</span>
</pre></div>
</div>
<p>And test it:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">chatie_ee</span><span class="p">(</span><span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">,</span>
                 <span class="n">list_event_types</span><span class="o">=</span><span class="n">event_types</span><span class="p">)</span>
<span class="n">test</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Argument_Role&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Place&#39;</span><span class="p">],</span>
 <span class="s1">&#39;Argument_Content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob and his wife&#39;</span><span class="p">,</span> <span class="s1">&#39;Yesterday&#39;</span><span class="p">,</span> <span class="s1">&#39;Guangzhou&#39;</span><span class="p">]}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="information-retrieval-with-the-react-framework">
<h2>Information Retrieval with the ReAct Framework<a class="headerlink" href="#information-retrieval-with-the-react-framework" title="Permalink to this headline">#</a></h2>
<p>Language models have demonstrated impressive capabilities across tasks in language understanding and abilities for reasoning (e.g. chain-of-thought prompting), such as illustrated by the ChatIE framework in the case of information extraction for example.</p>
<p>In a seminal paper, Yao et al. (2022) <span id="id3">[<a class="reference internal" href="../references.html#id39" title="Shunyu Yao, Jeffrey Zhao, Dian Yu, Nan Du, Izhak Shafran, Karthik Narasimhan, and Yuan Cao. React: synergizing reasoning and acting in language models. arXiv preprint arXiv:2210.03629, 2022.">YZY+22</a>]</span> proposed a new paradigm combining reasoning and acting paradigms, on which large language models capabilities have been previously applied.</p>
<p>In this framework, actions lead to observation feedback from an external environment. Reasoning traces affect the internal state of the model by reasoning over the context and updating it with information to support future reasoning and acting.</p>
<figure class="align-default" id="react">
<img alt="../_images/react.png" src="../_images/react.png" />
<figcaption>
<p><span class="caption-text">Figure: ReAct Framework, from Yao et al. (2022)</span><a class="headerlink" href="#react" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The <code class="docutils literal notranslate"><span class="pre">langchain</span></code> library uses this paradigm to allow ChatGPT interacting with its environment (eg. <code class="docutils literal notranslate"><span class="pre">tools</span></code>).</p>
<p>We illustrate it with an information retrieval task with <code class="docutils literal notranslate"><span class="pre">duckduckgo-search</span></code>.</p>
<p>You need first to install the <code class="docutils literal notranslate"><span class="pre">duckduckgo-search</span></code> package:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>!pip install duckduckgo-search
</pre></div>
</div>
<p>Let’s make a test with a simple search request:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.tools</span> <span class="kn">import</span> <span class="n">DuckDuckGoSearchRun</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">DuckDuckGoSearchRun</span><span class="p">()</span>
<span class="n">search</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Tesla stock price?&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We obtain the following result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Get the latest Tesla Inc (TSLA) real-time quote, historical performance, charts, and other financial information to help you make more informed trading and investment decisions. Quotes Summary May 26, 2023 6:00 am 8:00 am 10:00 am 12:00 pm 2:00 pm 4:00 pm 6:00 pm 182.5 185 187.5 190 192.5 195 197.5 200 Previous Close $184.47 Key Data Bid Price and Ask Price The bid &amp;... $203.93USD 2.77 1.38% PRE MARKET 4:37 AM EDT 06/01/23 $203.20 -0.73 -0.36% PRE MARKET Vol 67,058 Volume 150,711,736 65 Day Avg Vol 133,130,503 1 Day Range 195.12 - 203.95 52 Week Range 101.81 -... Discover historical prices for TSLA stock on Yahoo Finance. View daily, weekly or monthly format back to when Tesla, Inc. stock was issued. ﻿ intraday 1w 1m 6m ytd 1y 3y 5y max Mountain-Chart Date Compare with Remove all Compare with up to 5 Stocks On Tuesday 05/30/2023 the closing price of the Tesla share was $201.16 on NAS....
</pre></div>
</div>
<p>Let’s load all the modules needed and instantiate our endpoint with the ChatGPT API:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">load_tools</span>
<span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">initialize_agent</span>
<span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">AgentType</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We now create the tool that ChatGPT will have access to:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.tools</span> <span class="kn">import</span> <span class="n">BaseTool</span><span class="p">,</span> <span class="n">StructuredTool</span><span class="p">,</span> <span class="n">Tool</span><span class="p">,</span> <span class="n">tool</span>


<span class="n">duckduckgo_tool</span> <span class="o">=</span> <span class="n">Tool</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;DuckDuckGo Search&#39;</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Useful for when you need to do a search on the internet to find information that another tool can&#39;t find. be specific with your input.&quot;</span>
<span class="p">)</span>

<span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">duckduckgo_tool</span>
<span class="p">]</span>
</pre></div>
</div>
<p>We can now instantiate our <code class="docutils literal notranslate"><span class="pre">Agent</span></code> (ie. ChatGPT, with a specific ReAct prompt template):</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">initialize_agent</span>

<span class="n">zero_shot_agent</span> <span class="o">=</span> <span class="n">initialize_agent</span><span class="p">(</span>
    <span class="n">agent</span><span class="o">=</span><span class="n">AgentType</span><span class="o">.</span><span class="n">CHAT_ZERO_SHOT_REACT_DESCRIPTION</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> 
    <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s have a test:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">zero_shot_agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;When was Barak Obama born?&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>ChatGPT asks himself this question:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; Entering new AgentExecutor chain...
Question: When was Barak Obama born?
Thought: I don&#39;t know the answer to this question off the top of my head, so I will need to use a search engine to find the answer.
</pre></div>
</div>
<p>The following action is decided:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Action</span><span class="p">:</span>
<span class="p">{</span>
  <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;DuckDuckGo Search&quot;</span><span class="p">,</span>
  <span class="s2">&quot;action_input&quot;</span><span class="p">:</span> <span class="s2">&quot;Barack Obama birthdate&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following observation from the web search:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Observation</span><span class="p">:</span> <span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1961</span> <span class="p">(</span><span class="n">age</span> <span class="mi">61</span><span class="p">)</span> <span class="n">Honolulu</span> <span class="n">Hawaii</span> <span class="n">Title</span> <span class="o">/</span> <span class="n">Office</span><span class="p">:</span> <span class="n">presidency</span> <span class="n">of</span> <span class="n">the</span> <span class="n">United</span> <span class="n">States</span> <span class="n">of</span> <span class="n">America</span> <span class="p">(</span><span class="mi">2009</span><span class="o">-</span><span class="mi">2017</span><span class="p">),</span> <span class="n">United</span> <span class="n">States</span> <span class="n">United</span> <span class="n">States</span> <span class="n">Senate</span> <span class="p">(</span><span class="mi">2005</span><span class="o">-</span><span class="mi">2008</span><span class="p">),</span> <span class="n">United</span> <span class="n">States</span> <span class="o">...</span> <span class="p">(</span><span class="n">Show</span> <span class="n">more</span><span class="p">)</span> <span class="n">Political</span> <span class="n">Affiliation</span><span class="p">:</span> <span class="n">Democratic</span> <span class="n">Party</span> <span class="n">Awards</span> <span class="n">And</span> <span class="n">Honors</span><span class="p">:</span> <span class="n">Barack</span> <span class="n">Hussein</span> <span class="n">Obama</span> <span class="n">II</span> <span class="p">(</span><span class="o">/</span> <span class="n">b</span> <span class="n">ə</span> <span class="n">ˈ</span> <span class="n">r</span> <span class="n">ɑː</span> <span class="n">k</span> <span class="n">h</span> <span class="n">uː</span> <span class="n">ˈ</span> <span class="n">s</span> <span class="n">eɪ</span> <span class="n">n</span> <span class="n">oʊ</span> <span class="n">ˈ</span> <span class="n">b</span> <span class="n">ɑː</span> <span class="n">m</span> <span class="n">ə</span> <span class="o">/</span> <span class="n">bə</span><span class="o">-</span><span class="n">RAHK</span> <span class="n">hoo</span><span class="o">-</span><span class="n">SAYN</span> <span class="n">oh</span><span class="o">-</span><span class="n">BAH</span><span class="o">-</span><span class="n">mə</span><span class="p">;</span> <span class="n">born</span> <span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1961</span><span class="p">)</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">American</span> <span class="n">politician</span> <span class="n">who</span> <span class="n">served</span> <span class="k">as</span> <span class="n">the</span> <span class="mi">44</span><span class="n">th</span> <span class="n">president</span> <span class="n">of</span> <span class="n">the</span> <span class="n">United</span> <span class="n">States</span> <span class="kn">from</span> <span class="mi">2009</span> <span class="n">to</span> <span class="mf">2017.</span> <span class="n">A</span> <span class="n">member</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Democratic</span> <span class="n">Party</span><span class="p">,</span> <span class="n">he</span> <span class="n">was</span> <span class="n">the</span> <span class="n">first</span> <span class="n">African</span><span class="o">-</span><span class="n">American</span> <span class="n">president</span> <span class="n">of</span> <span class="n">the</span> <span class="n">United</span> <span class="n">States</span><span class="o">.</span> <span class="n">Obama</span> <span class="n">previously</span> <span class="n">served</span> <span class="k">as</span> <span class="n">a</span> <span class="n">U</span><span class="o">.</span><span class="n">S</span><span class="o">.</span> <span class="n">senator</span> <span class="n">representing</span> <span class="n">Illinois</span> <span class="o">...</span> <span class="n">Barack</span> <span class="n">Hussein</span> <span class="n">Obama</span><span class="p">,</span> <span class="n">the</span> <span class="mi">44</span><span class="n">th</span> <span class="ow">and</span> <span class="n">first</span> <span class="n">African</span><span class="o">-</span><span class="n">American</span> <span class="n">President</span> <span class="n">of</span> <span class="n">the</span> <span class="n">United</span> <span class="n">States</span><span class="p">,</span> <span class="n">served</span> <span class="kn">from</span> <span class="mi">2008</span> <span class="n">until</span> <span class="mf">2016.</span> <span class="ow">is</span> <span class="n">celebrating</span> <span class="n">his</span> <span class="mi">60</span><span class="n">th</span> <span class="n">Birthday</span> <span class="ow">in</span> <span class="mf">2021.</span> <span class="o">...</span> <span class="n">Birth</span> <span class="n">date</span><span class="p">:</span> <span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1961.</span> <span class="n">Age</span><span class="p">:</span> <span class="mf">61.</span> <span class="n">Zodiac</span> <span class="n">Sign</span><span class="p">:</span> <span class="n">Leo</span><span class="o">.</span> <span class="n">Background</span><span class="o">.</span> <span class="n">Barack</span> <span class="n">Obama</span> <span class="n">was</span> <span class="n">the</span> <span class="n">first</span> <span class="n">African</span> <span class="n">American</span> <span class="n">president</span> <span class="n">elected</span> <span class="k">as</span> <span class="n">the</span> <span class="mi">44</span><span class="n">th</span> <span class="n">president</span> <span class="n">of</span> <span class="n">the</span> <span class="n">United</span> <span class="n">States</span> <span class="n">of</span> <span class="o">...</span> <span class="n">Politics</span> <span class="n">On</span> <span class="n">Barack</span> <span class="n">Obama</span><span class="s1">&#39;s 61st Birthday, He Remembers His Late Mother — and Reveals New Project to Honor Her Former President Obama announced the Ann Dunham Water Garden in honor of his... August 4, 2022 at 2:09 PM · 3 min read. barack Obama in hawaii as a child. Courtesy The Obama Foundation From left: former President Barack Obama with his mother, Ann Dunham, in Hawaii in the &#39;</span><span class="mi">60</span><span class="n">s</span><span class="o">.</span> <span class="n">Barack</span> <span class="n">Obama</span> <span class="ow">is</span> <span class="n">celebrating</span> <span class="n">his</span> <span class="mi">61</span><span class="n">st</span> <span class="n">birthday</span> <span class="n">by</span> <span class="n">naming</span> <span class="n">a</span> <span class="n">new</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Obama</span> <span class="n">Presidential</span> <span class="n">Center</span> <span class="ow">in</span> <span class="n">Chicago</span> <span class="n">after</span> <span class="n">his</span> <span class="n">mother</span><span class="p">,</span> <span class="n">Ann</span> <span class="n">Dunham</span><span class="o">.</span>
</pre></div>
</div>
<p>And the thought is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Thought</span><span class="p">:</span><span class="n">The</span> <span class="n">answer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">question</span> <span class="s2">&quot;When was Barack Obama born?&quot;</span> <span class="ow">is</span> <span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1961.</span> 
<span class="n">Final</span> <span class="n">Answer</span><span class="p">:</span> <span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1961.</span>
</pre></div>
</div>
<p>The chain-of-thoughts if finished:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">Finished</span> <span class="n">chain</span><span class="o">.</span>
<span class="n">August</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1961.</span>
</pre></div>
</div>
</section>
<section id="exercice-reported-emissions-extraction-with-chatgpt">
<h2>Exercice: Reported Emissions Extraction with ChatGPT<a class="headerlink" href="#exercice-reported-emissions-extraction-with-chatgpt" title="Permalink to this headline">#</a></h2>
<p>With the ChatIE framework and Information Retrieval with the ReAct paradigm, you know have a toolkit you need for retrieving reported emissions with ChatGPT.</p>
<p>Let’s download a dataset with emissions for a handful of stocks:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/shokru/carbon_emissions/blob/main/data_fin.xlsx?raw=true&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Company&quot;</span><span class="p">:</span><span class="s2">&quot;Symbol&quot;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">payload</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s1">&#39;https://en.wikipedia.org/wiki/List_of_S%26P_500_companies&#39;</span><span class="p">)</span>
<span class="n">first_table</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">first_table</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Symbol&quot;</span><span class="p">,</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span><span class="s2">&quot;GICS Sector&quot;</span><span class="p">,</span><span class="s2">&quot;GICS Sub-Industry&quot;</span><span class="p">]],</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;Symbol&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Security&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;AT&amp;T&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Apple Inc.&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Bank of America&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Boeing&#39;</span><span class="p">,</span>
 <span class="s1">&#39;CVS Health&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Chevron Corporation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Cisco&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Citigroup&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Disney&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Dominion Energy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ExxonMobil&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Ford Motor Company&#39;</span><span class="p">,</span>
 <span class="s1">&#39;General Electric&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Home Depot (The)&#39;</span><span class="p">,</span>
 <span class="s1">&#39;IBM&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Intel&#39;</span><span class="p">,</span>
 <span class="s1">&#39;JPMorgan Chase&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Johnson &amp; Johnson&#39;</span><span class="p">,</span>
 <span class="s2">&quot;Kellogg&#39;s&quot;</span><span class="p">,</span>
 <span class="s1">&#39;McKesson&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Merck &amp; Co.&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Microsoft&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Oracle Corporation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Pfizer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Procter &amp; Gamble&#39;</span><span class="p">,</span>
 <span class="s1">&#39;United Parcel Service&#39;</span><span class="p">,</span>
 <span class="s1">&#39;UnitedHealth Group&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Verizon&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Walmart&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Wells Fargo&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Let’s try to retrieve emissions data for those companies, and compare your results with the emissions in the dataset!</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chatie">ChatIE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-information-extraction">What is Information Extraction?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chatie-framework-for-zero-shot-ie">ChatIE Framework for Zero-Shot IE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ie-tasks-and-chatie">IE Tasks and ChatIE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entity-relation-triple-extraction">Entity-Relation Triple Extraction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-re">First Stage RE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-re">Second Stage RE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#format-for-n-stages">Format for N Stages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#re-framework">RE Framework</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#named-entity-recognition">Named Entity Recognition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-ner">First Stage NER</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-ner">Second Stage NER</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Format for N Stages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ner-framework">NER Framework</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#event-extraction">Event Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-stage-ee">First Stage EE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-stage-ee">Second Stage EE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ee-framework">EE Framework</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#information-retrieval-with-the-react-framework">Information Retrieval with the ReAct Framework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-reported-emissions-extraction-with-chatgpt">Exercice: Reported Emissions Extraction with ChatGPT</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Lorans
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022, Thomas Lorans.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>